@page "/shoppackages/{shopid}"

@using Entities;
@using ShopAdmin.Data;
@inject IPackages ob;
@inject NavigationManager nm;

<button @onclick="()=>NaviagteToAddPackages(shopid)" class="btn btn-primary">Add Packages</button>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Packages Name</th>
            <th>Packages ID</th>
            <th>Shop ID</th>
            <th>Services</th>
            <th>Price</th>
            <th>Action</th>


        </tr>
    </thead>
    @foreach (var item in listpackages)
    {
        <tr>
            <td>@item.packagename</td>
            <td>@item.packageid</td>
            <td>@item.shopid</td>
            <td>@item.services</td>
            <td>@item.price</td>
            <td>
                <a>
                    <button @onclick="()=>UpdatePackage(item.packageid)" class="btn btn-primary">Update</button>

                </a>
            </td>
           <td>
                <a><button @onclick="()=>Delete(item.packageid)" class="btn btn-danger">Delete</button>

                </a>
            </td>
        </tr>
    }
</table>





@code {
    private List<EntPackages> listpackages { get; set; } = new List<EntPackages>();
    private int shopid;
    
    [Parameter]
    public string Shopid
    {
        get => shopid.ToString();
        set
        {
            if(int.TryParse(value,out int parsed))
            {
                shopid = parsed;
            }
        }
    }
    protected override async Task OnInitializedAsync()
    {
        listpackages = await ob.GetPackages(shopid);
    }

    private async Task Delete(int id)
    {
        await ob.DeletePackage(id);
        listpackages = await ob.GetPackages(shopid);
    }
    private async Task NaviagteToAddPackages(int shopid)
    {
        nm.NavigateTo($"/addpackage/{shopid}");
    }

    [Parameter] public static EntPackages UpdateBO { get; set; }
    private async Task UpdatePackage(int id)
    {
        UpdateBO = listpackages.Find(x => x.packageid == id);

        nm.NavigateTo($"/addpackage/{shopid}/update");
    }
}
